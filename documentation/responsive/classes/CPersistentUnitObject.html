<!DOCTYPE html><html xmlns:date="http://exslt.org/dates-and-times" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
<meta charset="utf-8">
<title>My Wrapper Reference » \CPersistentUnitObject</title>
<meta name="author" content="Mike van Riel">
<meta name="description" content="">
<link href="../css/template.css" rel="stylesheet" media="all">
<script src="../js/jquery-1.7.1.min.js" type="text/javascript"></script><script src="../js/jquery-ui-1.8.2.custom.min.js" type="text/javascript"></script><script src="../js/jquery.mousewheel.min.js" type="text/javascript"></script><script src="../js/bootstrap.js" type="text/javascript"></script><script src="../js/template.js" type="text/javascript"></script><script src="../js/prettify/prettify.min.js" type="text/javascript"></script><link rel="shortcut icon" href="../img/favicon.ico">
<link rel="apple-touch-icon" href="../img/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="72x72" href="../img/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="../img/apple-touch-icon-114x114.png">
</head>
<body>
<div class="navbar navbar-fixed-top">
<div class="navbar-inner"><div class="container">
<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a><a class="brand" href="../index.html">My Wrapper Reference</a><div class="nav-collapse"><ul class="nav">
<li class="dropdown">
<a href="#api" class="dropdown-toggle" data-toggle="dropdown">
                                    API Documentation <b class="caret"></b></a><ul class="dropdown-menu">
<li><a>Packages</a></li>
<li><a href="../packages/Default.html"><i class="icon-folder-open"></i> Default</a></li>
<li><a href="../packages/MyWrapper.html"><i class="icon-folder-open"></i> MyWrapper</a></li>
</ul>
</li>
<li class="dropdown" id="charts-menu">
<a href="#charts" class="dropdown-toggle" data-toggle="dropdown">
                                    Charts <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="../graph_class.html"><i class="icon-list-alt"></i> Class hierarchy diagram</a></li></ul>
</li>
<li class="dropdown" id="reports-menu">
<a href="#reports" class="dropdown-toggle" data-toggle="dropdown">
                                    Reports <b class="caret"></b></a><ul class="dropdown-menu">
<li><a href="../errors.html"><i class="icon-remove-sign"></i> Errors 
                <span class="label label-info">0</span></a></li>
<li><a href="../markers.html"><i class="icon-map-marker"></i> Markers 
                <ul></ul></a></li>
<li><a href="../deprecated.html"><i class="icon-stop"></i> Deprecated elements 
                <span class="label label-info">0</span></a></li>
</ul>
</li>
</ul></div>
</div></div>
<div class="go_to_top"><a href="#___" style="color: inherit">Back to top  <i class="icon-upload icon-white"></i></a></div>
</div>
<div id="___" class="container">
<noscript><div class="alert alert-warning">
                            Javascript is disabled; several features are only available
                            if Javascript is enabled.
                        </div></noscript>
<div class="row">
<div class="span4">
<span class="btn-group visibility" data-toggle="buttons-checkbox"><button class="btn public active" title="Show public elements">Public</button><button class="btn protected" title="Show protected elements">Protected</button><button class="btn private" title="Show private elements">Private</button><button class="btn inherited active" title="Show inherited elements">Inherited</button></span><div class="btn-group view pull-right" data-toggle="buttons-radio">
<button class="btn details" title="Show descriptions and method names"><i class="icon-list"></i></button><button class="btn simple" title="Show only method names"><i class="icon-align-justify"></i></button>
</div>
<ul class="side-nav nav nav-list">
<li class="nav-header">
<i class="icon-custom icon-method"></i> Methods</li>
<li class="method public "><a href="#HashIndex" title="HashIndex :: Hash index."><span class="description">Hash index.</span><pre>HashIndex()</pre></a></li>
<li class="method public "><a href="#NewObject" title="NewObject :: Instantiate object."><span class="description">Instantiate object.</span><pre>NewObject()</pre></a></li>
<li class="method public "><a href="#NormaliseRelatedObject" title="NormaliseRelatedObject :: Normalise object reference property."><span class="description">Normalise object reference property.</span><pre>NormaliseRelatedObject()</pre></a></li>
<li class="method public "><a href="#ObjectIdentifier" title="ObjectIdentifier :: Return object identifier."><span class="description">Return object identifier.</span><pre>ObjectIdentifier()</pre></a></li>
<li class="method public "><a href="#Persistent" title="Persistent :: Check whether object is persistent."><span class="description">Check whether object is persistent.</span><pre>Persistent()</pre></a></li>
<li class="method public "><a href="#Reference" title="Reference :: Convert an object to a reference."><span class="description">Convert an object to a reference.</span><pre>Reference()</pre></a></li>
<li class="method public "><a href="#__toString" title="__toString :: Return object identifier."><span class="description">Return object identifier.</span><pre>__toString()</pre></a></li>
<li class="nav-header protected">» Protected</li>
<li class="method protected "><a href="#NormaliseRelatedPredicate" title="NormaliseRelatedPredicate :: Normalise predicate reference property."><span class="description">Normalise predicate reference property.</span><pre>NormaliseRelatedPredicate()</pre></a></li>
<li class="method protected "><a href="#_Commit" title="_Commit :: Store object in container."><span class="description">Store object in container.</span><pre>_Commit()</pre></a></li>
<li class="method protected "><a href="#_CommitReferences" title="_CommitReferences :: Commit references."><span class="description">Commit references.</span><pre>_CommitReferences()</pre></a></li>
<li class="method protected "><a href="#_GetTags" title="_GetTags :: Get attribute tags."><span class="description">Get attribute tags.</span><pre>_GetTags()</pre></a></li>
<li class="method protected "><a href="#_ParseReferences" title="_ParseReferences :: Handle references."><span class="description">Handle references.</span><pre>_ParseReferences()</pre></a></li>
<li class="method protected "><a href="#_PrepareCommit" title="_PrepareCommit :: Normalise before a store."><span class="description">Normalise before a store.</span><pre>_PrepareCommit()</pre></a></li>
<li class="method protected "><a href="#_PrepareLoad" title="_PrepareLoad :: Normalise parameters of a find."><span class="description">Normalise parameters of a find.</span><pre>_PrepareLoad()</pre></a></li>
<li class="method protected "><a href="#_id" title="_id :: Return the object's unique identifier."><span class="description">Return the object's unique identifier.</span><pre>_id()</pre></a></li>
<li class="method protected "><a href="#_index" title="_index :: Return the object's unique index."><span class="description">Return the object's unique index.</span><pre>_index()</pre></a></li>
</ul>
</div>
<div class="span8">
<a name="%5CCPersistentUnitObject" id="\CPersistentUnitObject"></a><ul class="breadcrumb">
<li>
<a href="../index.html"><i class="icon-custom icon-class"></i></a><span class="divider">\</span>
</li>
<li><a href="../namespaces/.html"></a></li>
<li class="active">
<span class="divider">\</span><a href="../classes/CPersistentUnitObject.html">CPersistentUnitObject</a>
</li>
</ul>
<div href="../classes/CPersistentUnitObject.html" class="element class">
<p class="short_description">Unit objects ancestor.</p>
<div class="details">
<p class="long_description"><p>A unit object is one that has a unique identifier, that is, it can be uniquely identified
among a collection of other objects.</p>

<p>Instances derived from this class have a series of additional properties and methods that
govern how these can be stored and retrieved from containers.</p>

<p>The class features two read-only public methods that return:</p>

<ul>
<li><i><a href="_id()">_id()</a></i>: The object unique identifier as used by the native
    persistent container to uniquely identify the object.
<li><i><a href="_index()">_index()</a></i>: The full index that uniquely identifies the
    object, expressed as a string.
</ul>

<p>Although both methods seem to return the same information, they are different, in the
sense that the <a href="_index()">_index</a> method should return the property or properties
that constitute the object's unique identifier concatenated in a single string. This may
be too long to use as an index, so <a href="_id()">_id()</a> should return the actual value
used as the key, which may be the hashed <a href="_index()">_index</a> value. In other words,
<a href="_index()">_index</a> is the human readable version of <a href="_id()">_id</a>.</p>

<p>When the object is <a href="Commit">committed</a> for the first time, the value of the
<a href="_id()">_id</a> method will be set in the <a href="kTAG_LID">kTAG_LID</a> offset
which represents the object ID. This offset should never be changed and represents the
persistent identifier of the object.</p>

<p>The class implements the <a href="__toString()">__toString</a> method to return the value of
the object's <a href="_index()">index</a> by default.</p>

<p>This object also introduces the concept of object reference, that is, a structure that
can be used to refer to other objects. The class implements a series of protected methods
that derived classes can use to implement properties that point to other objects:</p>

<ul>
<li><i><a href="_ParseReferences()">_ParseReferences</a></i>: When adding object references to
    properties one is also allowed to add the actual instance, at
    <a href="Commit()">commit</a> time, these objects must also be committed before committing
    the object that references them: this method will handle this.
<li><i><a href="CAttribute::ManageObjectList()">ManageObjectList</a></i>: This method can be
    used as a base for handling properties that consist of object references lists. It
    handles a list of scalar object reference elements or a list of predicate/object
    pairs.
<li><i><a href="NormaliseRelatedObject()">NormaliseRelatedObject</a></i>: This method can be
    used to normalise parameters that expect object references, these can be overloaded
    by derived classes to implement a custom framework.
<li><i><a href="NormaliseRelatedPredicate()">NormaliseRelatedPredicate</a></i>: This method
    can be used to normalise parameters that expect predicate object references, these
    can be overloaded by derived classes to implement a custom framework.
</ul>

<p>The above protected interface is not used in this class, but it is made available to
derived classes in order to handle objects derived from this class.</p>

<p>Objects derived from this class also hold, by default, their class name in an
<a href="kTAG_CLASS">offset</a>, this is used to <a href="NewObject()">instantiate</a> objects of
thecorrect class when retrieving data from a container.</p>

<p>This class also features a <a href="kTAG_VERSION">version</a> which is an integer,
incremented each time the object is <a href="Commit()">committed</a>: this is  useful to
implement a concurrency control mechanism.</p>

<p>Starting from this class we only handle <a href="CContainer">CContainer</a> derived instances
as containers, other container types will not be supported. This is because
<a href="CContainer">CContainer</a> derived instances have an
<a href="CDataType::SerialiseObject()">serialise</a> and
<a href="CMongoDataWrapper::UnserialiseObject()">unserialise</a> interface for handling special
data types.</p>

<p>The specifics of this are managed by the <a href="CContainer">CContainer</a> derived classes,
so when planning your objects think in advance in what containers you plan to store them.</p>

<p>Finally, this class features a series of static methods;</p>

<ul>
<li><i><a href="NewObject()">NewObject</a></i>: This method can be used to instantiate a class
    from a mixed class data store, it accepts the same parameters as the
    <a href="__construct()">constructor</a>, but will return an instance of the correct
    <a href="kTAG_CLASS">class</a>.
<li><i><a href="Reference()">Reference</a></i>: This method will convert an instance derived
    from this class into a standard object reference structure in which it is possible
    to indicate both the <a href="kTAG_REFERENCE_CONTAINER">container</a> and the
    <a href="kTAG_REFERENCE_DATABASE">database</a>.
</ul>

<p>We declare the class abstract because the object must be <a href="_IsInited()">inited</a> to be
<a href="Commit()">committed</a> and the <a href="_index()">index</a> must be explicitly implemented.</p></p>
<table class="table table-bordered">
<tr>
<th>package</th>
<td><a href="../packages/MyWrapper.Persistence.html">MyWrapper</a></td>
</tr>
<tr>
<th>subpackage</th>
<td>Persistence</td>
</tr>
</table>
<h3>
<i class="icon-custom icon-method"></i> Methods</h3>
<a name="HashIndex" id="HashIndex"></a><div class="element clickable method public HashIndex" data-toggle="collapse" data-target=".HashIndex .collapse">
<h2>Hash index.</h2>
<pre>HashIndex(string $theValue) : string</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method can be used to format an identifier provided as a string, it will be
used by the <a href="_id()">_id</a> method to format the result of the
<a href="_index()">_index</a> method.</p>

<p>All derived classes will call this method to format the object <a href="kTAG_LID">ID</a>,
so you should overload this method in classes where the current behaviour is not
desirable.</p></p>
<table class="table table-bordered"><tr>
<th>static</th>
<td></td>
</tr></table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theValue</h4>
<code>string</code><p>Value to hash.</p></div>
<h3>Returns</h3>
<div class="subelement response"><code>string</code></div>
</div></div>
</div>
<a name="NewObject" id="NewObject"></a><div class="element clickable method public NewObject" data-toggle="collapse" data-target=".NewObject .collapse">
<h2>Instantiate object.</h2>
<pre>NewObject(mixed $theContainer, mixed $theIdentifier, \bitfield $theModifiers) : mixed</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method can be used to instantiate an object from a mixed class data store, it
expects the container to be a <a href="CContainer">CContainer</a> derived instance and the
identifier to be the <a href="_id()">unique</a> <a href="kTAG_LID">identifier</a> of the
object.</p>

<p>This method takes advantage of the <a href="Commit()">stored</a>
<a href="kTAG_CLASS">class</a> name.</p>

<p>The method will return an object, if the identifier matches and the object has its
<a href="kTAG_CLASS">class</a> name; an array if the identifier matches, but the data
doesn't contain a @link kTAG_CLASS class} name reference; <i>NULL</i> if the
identifier didn't match.</p></p>
<table class="table table-bordered"><tr>
<th>static</th>
<td></td>
</tr></table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theContainer</h4>
<code>mixed</code><p>Persistent container.</p></div>
<div class="subelement argument">
<h4>$theIdentifier</h4>
<code>mixed</code><p>Object identifier.</p></div>
<div class="subelement argument">
<h4>$theModifiers</h4>
<code>\bitfield</code><p>Create modifiers.</p></div>
<h3>Returns</h3>
<div class="subelement response"><code>mixed</code></div>
</div></div>
</div>
<a name="NormaliseRelatedObject" id="NormaliseRelatedObject"></a><div class="element clickable method public NormaliseRelatedObject" data-toggle="collapse" data-target=".NormaliseRelatedObject .collapse">
<h2>Normalise object reference property.</h2>
<pre>NormaliseRelatedObject(mixed $theValue) : mixed</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method can be used to normalise a property that is supposed to be a reference
to another object, the method will perform the following conversions:</p>

<ul>
<li><i>CPersistentUnitObject</i>: Objects derived from this class will be handled as
    follows:
 <ul>
    <li><i><a href="_IsCommitted()">Committed</a></i>: If the provided object has a
        <a href="_IsCommitted()">committed</a> <a href="kFLAG_STATE_COMMITTED">status</a>, the
        method will return the object's <a href="kTAG_LID">identifier</a>.
    <li><i>Not <a href="_IsCommitted()">committed</a></i>: The parameter will not be
        converted.
 </ul>
<li><i><a href="CDataType">CDataType</a></i>: When providing a complex data type, we
    assume the value corresponds to the <a href="kTAG_LID">identifier</a>, in which case
    we leave it untouched.
<li><i>Array</i> or <i>ArrayObject</i>: In this case the method will assume the
    provided structure is an object reference and it will check if the
    <a href="kTAG_REFERENCE_ID">kTAG_REFERENCE_ID</a> offset is there, if this is
    not the case the method will raise an exception.
<li><i>other</i>: Any other type will be converted to a string.
</ul>

<p>The method will return the converted value.</p></p>
<table class="table table-bordered">
<tr>
<th>static</th>
<td></td>
</tr>
<tr>
<th>see</th>
<td>\kTAG_LID</td>
</tr>
<tr>
<th>used_by</th>
<td>\CRelatedUnitObject::Relate()</td>
</tr>
</table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theValue</h4>
<code>mixed</code><p>Object or reference.</p></div>
<h3>Returns</h3>
<div class="subelement response"><code>mixed</code></div>
</div></div>
</div>
<a name="ObjectIdentifier" id="ObjectIdentifier"></a><div class="element clickable method public ObjectIdentifier" data-toggle="collapse" data-target=".ObjectIdentifier .collapse">
<h2>Return object identifier.</h2>
<pre>ObjectIdentifier(mixed $theValue) : string | NULL</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method is a utility that can be used to extract an object identifier from a
value, it is used when adding objects or object references to a list that is not
organised by object <a href="kTAG_LID">ID</a>.</p>

<p>This method will attempt to infer the object identifier by performing the following
steps:</p>

<ul>
<li><i>Array</i> or <i>ArrayObject</i>: In this case we interpret the parameter to
    be either an instance of the object itself, or a reference to the object, we
    check in order if any of the following can be found:
 <ul>
    <li><i><a href="kTAG_LID">kTAG_LID</a></i>: We first check whether the
        object has that offset and use it is so.
    <li><i><a href="kTAG_REFERENCE_ID">kTAG_REFERENCE_ID</a></i>: We then check
        whether the structure contains a reference identifier.
    <li><i><a href="_id()">_id</a></i>: If the parameter is an object derived from this
        class, we try to call this method and use its result.
 </ul>
<li><i>other</i>: If all of the above fails we simply return the provided value.
</ul>

<p>Note that the method assumes that the returned value must be convertable to a string,
if that is not the case you may get into trouble.</p></p>
<table class="table table-bordered"><tr>
<th>static</th>
<td></td>
</tr></table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theValue</h4>
<code>mixed</code><p>Object or identifier.</p></div>
<h3>Returns</h3>
<div class="subelement response">
<code>string</code><code>NULL</code>
</div>
</div></div>
</div>
<a name="Persistent" id="Persistent"></a><div class="element clickable method public Persistent" data-toggle="collapse" data-target=".Persistent .collapse">
<h2>Check whether object is persistent.</h2>
<pre>Persistent() : boolean</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method will return <i>TRUE</i> if the object has the <a href="kTAG_LID">local</a>
identifier, this would mean that the object has either been <a href="Commit()">saved</a>
or that the object was <a href="_Load()">loaded</a> from a <a href="CContainer">container</a>.</p></p>
<table class="table table-bordered"><tr>
<th>access</th>
<td>public</td>
</tr></table>
<h3>Returns</h3>
<div class="subelement response"><code>boolean</code></div>
</div></div>
</div>
<a name="Reference" id="Reference"></a><div class="element clickable method public Reference" data-toggle="collapse" data-target=".Reference .collapse">
<h2>Convert an object to a reference.</h2>
<pre>Reference(mixed $theObject, \bitfield $theModifiers) : mixed</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method accepts an object derived from this class and returns a structure that
can be used as a reference to that object.</p>

<p>The method will return an array composed by the following offsets:</p>

<ul>
<li><i><a href="kTAG_REFERENCE_ID">kTAG_REFERENCE_ID</a></i>: The object identifier,
    if the provided object does not have an <a href="kTAG_LID">identifier</a>, this
    method will search for a <a href="kTAG_REFERENCE_ID">reference</a>.
<li><i><a href="kTAG_REFERENCE_CONTAINER">kTAG_REFERENCE_CONTAINER</a></i>: The
    container name, if the provided object is a reference.
<li><i><a href="kTAG_REFERENCE_DATABASE">kTAG_REFERENCE_DATABASE</a></i>: The
    database name, if the provided object is a reference.
<li><i><a href="kTAG_CLASS">kTAG_CLASS</a></i>: If the provided object is derived
    from this class, the object's class.
</ul>

<p>The method accepts two parameters:</p>

<ul>
<li><b>$theObject</b>: The object to be referenced, or a structure containing a
    reference.
<li><b>$theModifiers</b>: This bitfield determines what elements should be included
    in the reference:
 <ul>
    <li><i><a href="kFLAG_REFERENCE_IDENTIFIER">kFLAG_REFERENCE_IDENTIFIER</a></i>: The
        object <a href="kTAG_LID">identifier</a> will be stored under the
        <a href="kTAG_REFERENCE_ID">kTAG_REFERENCE_ID</a> offset. If the object does
        not have this identifier, the method will raise an exception. This is the
        default option.
    <li><i><a href="kFLAG_REFERENCE_CONTAINER">kFLAG_REFERENCE_CONTAINER</a></i>: The
        container name if available.
    <li><i><a href="kFLAG_REFERENCE_DATABASE">kFLAG_REFERENCE_DATABASE</a></i>: The
        container's database name if available.
    <li><i><a href="kFLAG_REFERENCE_CLASS">kFLAG_REFERENCE_CLASS</a></i>: The provided
        object's class name if derived from this class.
 </ul>
</ul>

<p>If the provided object cannot be resolved, the method will return <i>NULL</i>.</p></p>
<table class="table table-bordered">
<tr>
<th>static</th>
<td></td>
</tr>
<tr>
<th>see</th>
<td>\kFLAG_REFERENCE_IDENTIFIER</td>
</tr>
<tr>
<th>see</th>
<td>\kFLAG_REFERENCE_DATABASE</td>
</tr>
<tr>
<th>see</th>
<td>\kTAG_REFERENCE_ID</td>
</tr>
<tr>
<th>see</th>
<td>\kTAG_CLASS</td>
</tr>
</table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theObject</h4>
<code>mixed</code><p>Object to reference.</p></div>
<div class="subelement argument">
<h4>$theModifiers</h4>
<code>\bitfield</code><p>Referencing options.</p></div>
<h3>Returns</h3>
<div class="subelement response"><code>mixed</code></div>
</div></div>
</div>
<a name="__toString" id="__toString"></a><div class="element clickable method public __toString" data-toggle="collapse" data-target=".__toString .collapse">
<h2>Return object identifier.</h2>
<pre>__toString() : string</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>In this class we return the object string <a href="_index()">identifier</a>.</p></p>
<table class="table table-bordered">
<tr>
<th>access</th>
<td>public</td>
</tr>
<tr>
<th>uses</th>
<td>\_index()</td>
</tr>
</table>
<h3>Returns</h3>
<div class="subelement response"><code>string</code></div>
</div></div>
</div>
<a name="NormaliseRelatedPredicate" id="NormaliseRelatedPredicate"></a><div class="element clickable method protected NormaliseRelatedPredicate" data-toggle="collapse" data-target=".NormaliseRelatedPredicate .collapse">
<h2>Normalise predicate reference property.</h2>
<pre>NormaliseRelatedPredicate(mixed $theValue) : mixed</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method can be used to normalise a property that is supposed to be a relation
predicate, the method will perform the following conversions:</p>

<ul>
<li><i>NULL</i>: No conversion.
<li><i>FALSE</i>: No conversion.
<li><i>CGraphNodeObject</i>: The method will pass the parameter to the
    <a href="NormaliseRelatedObject()">NormaliseRelatedObject</a> method.
<li><i><a href="CDataType">CDataType</a></i>: The method will pass the parameter to the
    <a href="NormaliseRelatedObject()">NormaliseRelatedObject</a> method.
<li><i>Array</i> or <i>ArrayObject</i>: The method will pass the parameter to the
    <a href="NormaliseRelatedObject()">NormaliseRelatedObject</a> method.
<li><i>other</i>: Any other type will be converted to a string.
</ul>

<p>The method will return the converted value, derived classes should first handle
custom types and pass other types to the parent method.</p></p>
<table class="table table-bordered">
<tr>
<th>access</th>
<td>protected</td>
</tr>
<tr>
<th>uses</th>
<td>\_IsCommitted()</td>
</tr>
<tr>
<th>see</th>
<td>\kTAG_LID</td>
</tr>
<tr>
<th>used_by</th>
<td>\CRelatedUnitObject::Relate()</td>
</tr>
</table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theValue</h4>
<code>mixed</code><p>Relation predicate.</p></div>
<h3>Returns</h3>
<div class="subelement response"><code>mixed</code></div>
</div></div>
</div>
<a name="_Commit" id="_Commit"></a><div class="element clickable method protected _Commit" data-toggle="collapse" data-target="._Commit .collapse">
<h2>Store object in container.</h2>
<pre>_Commit(\reference $theContainer, \reference $theIdentifier, \reference $theModifiers) : mixed</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>We overload this method to <a href="_GetTags()">collect</a> and <a href="_SetTags()">set</a> the
object tags.</p></p>
<table class="table table-bordered"><tr>
<th>access</th>
<td>protected</td>
</tr></table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theContainer</h4>
<code>\reference</code><p>&$theContainer Object container.</p>
</div>
<div class="subelement argument">
<h4>$theIdentifier</h4>
<code>\reference</code><p>&$theIdentifier Object identifier.</p>
</div>
<div class="subelement argument">
<h4>$theModifiers</h4>
<code>\reference</code><p>&$theModifiers Commit modifiers.</p>
</div>
<h3>Returns</h3>
<div class="subelement response"><code>mixed</code></div>
</div></div>
</div>
<a name="_CommitReferences" id="_CommitReferences"></a><div class="element clickable method protected _CommitReferences" data-toggle="collapse" data-target="._CommitReferences .collapse">
<h2>Commit references.</h2>
<pre>_CommitReferences(\reference $theReference, <a href="../classes/CContainer.html">\CContainer</a> $theContainer, \bitfield $theModifiers, integer $doRecurse) </pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method will parse the provided value looking for object references, if such
references are expressed as instances derived from this class, it will will
<a href="Commit()">commit</a> these instances and convert them to object references.</p>

<p>The method will first check if the provided reference is a scalar, then it will
check if it is a predicate/object par and finally it will check if it is a list of
references.</p>

<p>The parameters to this method are:</p>

<ul>
<li><b>$theReference</b>: The reference to be parsed, the conversion will replace
    the provided parameter.
<li><b>$theContainer</b>: The container in which the referenced object(s) resides,
    please refer to the documentation of
    <a href="_ParseReferences()">_ParseReferences</a> for more information.
<li><b>$theModifiers</b>: A bitfield indicating which elements of the
    <a href="CContainer::Reference()">reference</a> should be included, please refer to
    the documentation of <a href="_ParseReferences()">_ParseReferences</a> for more
    information.
<li><b>$doRecurse</b>: This is a private parameter that you should leave untouched, it
    it determines whether or not to recurse this method: it starts with a value of
    2, and at each recursion the value decreases, when it reaches zero, structures
    will no more be considered.
</ul>

<p>The method follows this set of rules:</p>

<ul>
<li><i>Handle scalars</i>: A scalar element may be an instance derived from this
    class, an instance derived from CDataType, or anything that is not an array or
    an ArrayObject. If the scalar is an instance of this class, we
    <a href="Commit()">commit</a> the instance and convert it to an object reference.
<li><i>Handle structures</i>: Once we have determined it is not a scalar, we check
    if it is either a predicate/object pair, or if it is a list of references; in
    the both cases the elements will be passed recursively to this method.
</ul>

<p>Note that when we <a href="Commit()">commit</a> referenced objects we use
<a href="kFLAG_PERSIST_REPLACE">kFLAG_PERSIST_REPLACE</a> as the commit type.</p>

<p>The method will return <i>TRUE</i> is a conversion occurred and <i>FALSE</i> if not.</p></p>
<table class="table table-bordered">
<tr>
<th>access</th>
<td>protected</td>
</tr>
<tr>
<th>uses</th>
<td>\_CommitReference()</td>
</tr>
</table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theReference</h4>
<code>\reference</code><p>&$theReference Reference.</p>
</div>
<div class="subelement argument">
<h4>$theContainer</h4>
<code><a href="../classes/CContainer.html">\CContainer</a></code><p>Object container.</p></div>
<div class="subelement argument">
<h4>$theModifiers</h4>
<code>\bitfield</code><p>Reference options.</p></div>
<div class="subelement argument">
<h4>$doRecurse</h4>
<code>integer</code><p>Recurse level.</p></div>
</div></div>
</div>
<a name="_GetTags" id="_GetTags"></a><div class="element clickable method protected _GetTags" data-toggle="collapse" data-target="._GetTags .collapse">
<h2>Get attribute tags.</h2>
<pre>_GetTags() : array</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>In this class we exclude the <a href="kTAG_LID">kTAG_LID</a>, <a href="kTAG_CLASS">kTAG_CLASS</a>
and <a href="kTAG_VERSION">kTAG_VERSION</a> tags, since they are set by default.</p></p>
<table class="table table-bordered"><tr>
<th>access</th>
<td>protected</td>
</tr></table>
<h3>Returns</h3>
<div class="subelement response"><code>array</code></div>
</div></div>
</div>
<a name="_ParseReferences" id="_ParseReferences"></a><div class="element clickable method protected _ParseReferences" data-toggle="collapse" data-target="._ParseReferences .collapse">
<h2>Handle references.</h2>
<pre>_ParseReferences(string $theOffset, <a href="../classes/CContainer.html">\CContainer</a> $theContainer, \bitfield $theModifiers) </pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method will parse the provided offset and convert all instances derived from
this class to object references according to a series of rules.</p>

<p>Object references may have two forms:</p>

<ul>
<li><i>Scalar</i>: A scalar value represents the object
    <a href="kTAG_LID">identifier</a>.
<li><i>Object reference structure</i>: This form is a structure holding the
    following elements:
 <ul>
    <li><i><a href="kTAG_REFERENCE_ID">kTAG_REFERENCE_ID</a></i>: This offset holds
        the object's <a href="kTAG_LID">identifier</a>.
    <li><i><a href="kTAG_REFERENCE_CONTAINER">kTAG_REFERENCE_CONTAINER</a></i>: This
        offset holds the container name in which the object resides.
    <li><i><a href="kTAG_REFERENCE_DATABASE">kTAG_REFERENCE_DATABASE</a></i>: This
        offset holds the database name in which the object resides.
    <li><i><a href="kTAG_CLASS">kTAG_CLASS</a></i>: This offset holds the object's
        class name.
 </ul>
    Such structures should not have any other allowed offset.
</ul>

<p>Object references are stored in offsets with the following forms:</p>

<ul>
<li><i>Scalar</i>: The offset holds the object reference as a scalar element.
<li><i>Typed</i>: A typed object reference consists of a structure in which the
    <a href="kTAG_DATA">kTAG_DATA</a> offset holds the object reference and an optional
    <a href="kTAG_KIND">kTAG_KIND</a> offset holds the relation predicate, which may also
    be in the form of an object reference.
<li><i>List</i>: A list of references whose elements may be a combination of the
    previous two formats.
</ul>

<p>This method will pass the provided offset value to a
<a href="_CommitReferences()">method</a> that will take care of parsing the contents and
<a href="_CommitReference()">committing</a> all instances derived from this class into
object references according to the provided modifier flags.</p>

<p>The parameters to this method are:</p>

<ul>
<li><b>$theOffset</b>: The current object's offset that holds the reference or
    references.
<li><b>$theContainer</b>: The container that is about to receive the current object,
    it must also be the container in which to find the references and must be
    derived from <a href="CContainer">CContainer</a>.
<li><b>$theModifiers</b>: A bitfield indicating which elements should be included in
    the <a href="CContainer::Reference()">reference</a>:
 <ul>
    <li><i><a href="kFLAG_REFERENCE_IDENTIFIER">kFLAG_REFERENCE_IDENTIFIER</a></i>: The
        object <a href="kTAG_LID">identifier</a> will be stored under the
        <a href="kTAG_REFERENCE_ID">kTAG_REFERENCE_ID</a> offset. This option is
        enforced.
    <li><i><a href="kFLAG_REFERENCE_CONTAINER">kFLAG_REFERENCE_CONTAINER</a></i>: The
        provided container name will be stored under the
        <a href="kTAG_REFERENCE_CONTAINER">kTAG_REFERENCE_CONTAINER</a> offset. If
        the provided value is empty, the offset will not be set.
    <li><i><a href="kFLAG_REFERENCE_DATABASE">kFLAG_REFERENCE_DATABASE</a></i>: The
        provided container's database name will be stored under the
        <a href="kTAG_REFERENCE_DATABASE">kTAG_REFERENCE_DATABASE</a> offset. If the
        current object's <a href="Database()">database</a> name is <i>NULL</i>, the
        offset will not be set.
    <li><i><a href="kFLAG_REFERENCE_CLASS">kFLAG_REFERENCE_CLASS</a></i>: The element
        object's class name will be stored under the
        <a href="kTAG_CLASS">kTAG_CLASS</a> offset.
 </ul>
    If none of the above flags are set, it means that object references are
    expressed directly as the value of the <a href="kTAG_LID">identifier</a>, and that
    <a href="kTAG_REFERENCE_CONTAINER">container</a> and
    <a href="kTAG_REFERENCE_DATABASE">database</a> are implicit.
</ul></p>
<table class="table table-bordered">
<tr>
<th>access</th>
<td>protected</td>
</tr>
<tr>
<th>uses</th>
<td>\_CommitReference()</td>
</tr>
</table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theOffset</h4>
<code>string</code><p>Reference list offset.</p></div>
<div class="subelement argument">
<h4>$theContainer</h4>
<code><a href="../classes/CContainer.html">\CContainer</a></code><p>Object container.</p></div>
<div class="subelement argument">
<h4>$theModifiers</h4>
<code>\bitfield</code><p>Referencing options.</p></div>
</div></div>
</div>
<a name="_PrepareCommit" id="_PrepareCommit"></a><div class="element clickable method protected _PrepareCommit" data-toggle="collapse" data-target="._PrepareCommit .collapse">
<h2>Normalise before a store.</h2>
<pre>_PrepareCommit(\reference $theContainer, \reference $theIdentifier, \reference $theModifiers) </pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>We <a href="CPersistentObject::_PrepareCommit()">overload</a> this method to perform the
following steps:</p>

<ul>
<li><i>Identifier as structure</i>: We handle identifiers provided as object
    structures or references by checking the <a href="kTAG_LID">native</a> identifier
    or the object <a href="kTAG_REFERENCE_ID">reference</a>.
<li><i>Set identifier</i>: If the current object has already an
    <a href="kTAG_LID">identifier</a> and an identifier was not provided we set it, if
    this is not the case we set it via the <a href="_id()">_id</a> method.
<li><i>Call parent method</i>: We then call the parent method, this is to ensure all
    required data is provided.
<li><i><a href="kTAG_CLASS">kTAG_CLASS</a></i>: We set this offset with the current
    object's class name. Note that we overwrite old values.
<li><i><a href="kTAG_VERSION">kTAG_VERSION</a></i>: If not set, we initialise this
    value to zero, if already set, we increment it.
</ul>

<p>identifiers
provided as structures containing either the <a href="kTAG_LID">native</a> identifier
or an object <a href="kTAG_REFERENCE_ID">reference</a>.</p>

<p>The duty of this method is to ensure that the parameters provided to the
<a href="_Commit()">store</a> operation are correct.</p>

<p>In this class we ensure that the container is a ArrayObject or a
<a href="CContainer">CContainer</a> derived instance and we ensure the identifier is filled
in the case it was not provided:</p>

<ul>
<li><i>Get <a href="kTAG_LID">kTAG_LID</a></i>: If the object features the
    <a href="kTAG_LID">kTAG_LID</a> offset, it will be preferred. This is
    necessary, because we don't want the object identifier to change in time.
<li><i>Use the <a href="_id()">:id</a> method</i>: We use the value returned by the
    <a href="_id()">_id</a> protected method, this will be the case when
    <a href="Commit()">saving</a> new objects.
</ul>

<p>We also handle here the other two default offsets:</p>

<ul>
<li><i><a href="kTAG_CLASS">kTAG_CLASS</a></i>: We set this offset with the current
    object's name. Note that we overwrite old values.
<li><i><a href="kTAG_VERSION">kTAG_VERSION</a></i>: If not set, we initialise this
    value to zero, if already set, we increment it.
</ul></p>
<table class="table table-bordered">
<tr>
<th>access</th>
<td>protected</td>
</tr>
<tr>
<th>see</th>
<td>\kERROR_OPTION_MISSING</td>
</tr>
</table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theContainer</h4>
<code>\reference</code><p>&$theContainer Object container.</p>
</div>
<div class="subelement argument">
<h4>$theIdentifier</h4>
<code>\reference</code><p>&$theIdentifier Object identifier.</p>
</div>
<div class="subelement argument">
<h4>$theModifiers</h4>
<code>\reference</code><p>&$theModifiers Commit modifiers.</p>
</div>
<h3>Exceptions</h3>
<table class="table table-bordered"><tr>
<th><code>\{@link</code></th>
<td>CException CException}</td>
</tr></table>
</div></div>
</div>
<a name="_PrepareLoad" id="_PrepareLoad"></a><div class="element clickable method protected _PrepareLoad" data-toggle="collapse" data-target="._PrepareLoad .collapse">
<h2>Normalise parameters of a find.</h2>
<pre>_PrepareLoad(\reference $theContainer, \reference $theIdentifier, \reference $theModifiers) </pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>We <a href="CPersistentObject::_PrepareLoad()">overload</a> this method to handle
identifiers provided as structures containing either the <a href="kTAG_LID">native</a>
identifier or an object <a href="kTAG_REFERENCE_ID">reference</a>.</p>

<p>We also handle queries provided in the identifier, in this case we only check whether
the container is supported.</p></p>
<table class="table table-bordered">
<tr>
<th>access</th>
<td>protected</td>
</tr>
<tr>
<th>see</th>
<td>\kERROR_OPTION_MISSING</td>
</tr>
</table>
<h3>Parameters</h3>
<div class="subelement argument">
<h4>$theContainer</h4>
<code>\reference</code><p>&$theContainer Object container.</p>
</div>
<div class="subelement argument">
<h4>$theIdentifier</h4>
<code>\reference</code><p>&$theIdentifier Object identifier.</p>
</div>
<div class="subelement argument">
<h4>$theModifiers</h4>
<code>\reference</code><p>&$theModifiers Create modifiers.</p>
</div>
<h3>Exceptions</h3>
<table class="table table-bordered"><tr>
<th><code>\{@link</code></th>
<td>CException CException}</td>
</tr></table>
</div></div>
</div>
<a name="_id" id="_id"></a><div class="element clickable method protected _id" data-toggle="collapse" data-target="._id .collapse">
<h2>Return the object's unique identifier.</h2>
<pre>_id() : mixed</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method can be used to return a value that represents the object's unique
native identifier. The method should use the value returned by the
<a href="_index()">_index</a> method and hash it if necessary.</p>

<p>This method will be called <a href="_PrepareCommit()">before</a> <a href="Commit()">committing</a>
the object to fill its unique identifier <a href="kTAG_LID">offset</a>.</p>

<p>If this method returns <i>NULL</i>, it is assumed that it will be the
<a href="CContainer">container</a> that will provide a default unique value.</p>

<p>In this class we return the <a href="HashIndex()">hashed</a> value of
<a href="_index()">_index</a>.</p></p>
<table class="table table-bordered"><tr>
<th>access</th>
<td>protected</td>
</tr></table>
<h3>Returns</h3>
<div class="subelement response"><code>mixed</code></div>
</div></div>
</div>
<a name="_index" id="_index"></a><div class="element clickable method protected _index" data-toggle="collapse" data-target="._index .collapse">
<h2>Return the object's unique index.</h2>
<pre>_index() : string</pre>
<div class="labels"></div>
<div class="row collapse"><div class="detail-description">
<p class="long_description"><p>This method can be used to return a string value that represents the object's unique
identifier. This value should generally be extracted from the object's properties.</p>

<p>In general this value will be used by the <a href="_id()">_id</a> method to form the
object's unique <a href="kTAG_LID">identifier</a>, maybe hashed to make the index
smaller.</p>

<p>In this class we require derived classes to implement the method.</p></p>
<table class="table table-bordered"><tr>
<th>access</th>
<td>protected</td>
</tr></table>
<h3>Returns</h3>
<div class="subelement response"><code>string</code></div>
</div></div>
</div>
</div>
</div>
</div>
</div>
<div class="row"><footer class="span12">
            Template is built using <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap 2</a> and icons provided by <a href="http://glyphicons.com/">Glyphicons</a>.<br>
            Documentation is powered by <a href="http://www.phpdoc.org/">phpDocumentor 2.0.0a6</a> and<br>
            generated on 2012-07-03T16:30:36+02:00.<br></footer></div>
</div>
</body>
</html>
